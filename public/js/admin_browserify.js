!function e(r,n,t){function i(o,s){if(!n[o]){if(!r[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};r[o][0].call(c.exports,function(e){var n=r[o][1][e];return i(n?n:e)},c,c.exports,e,r,n,t)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<t.length;o++)i(t[o]);return i}({1:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}var i=e("./router"),a=t(i);$(function(){console.log("ready");new a["default"];$.ajaxSetup({headers:{"X-CSRF-Token":window._token}}),$(".multiselect").multiselect({nonSelectedText:"Выберите значение",numberDisplayed:1})})},{"./router":9}],2:[function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();n["default"]=new(function(){function e(){t(this,e)}return i(e,[{key:"index",value:function(){$(".duplicateForm").click(this._cloneFormField),$("input[name=address]").on("change",this._onChangeAddress)}},{key:"_onChangeAddress",value:function(e){var r=$(e.currentTarget),n=/^(\d+)/.exec(r.val());if(n&&$("input[name=postCode]").val(n[1]),n=/(?:місто|м\.)\s*([а-яїґ]+)/i.exec(r.val())){var t=$("select[name=city]"),i=t.find("option").filter(function(e,r){return $(r).text().toLowerCase()==n[1].toLowerCase()});i.attr("selected","true"),t.multiselect("refresh")}}},{key:"_cloneFormField",value:function(e){var r=$(e.target.parentNode);r.prepend(r.find("input:first").clone().val(""))}}]),e}())},{}],3:[function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();n["default"]=new(function(){function e(){t(this,e)}return i(e,[{key:"index",value:function(){$(".inquiry").click(function(e){var r=$(e.currentTarget);console.log(r.data("note"));var n=prompt("Примечание к запросу:",r.data("note"));if(null!==n)return $.ajax({url:"/admin/api/organization_inquiry/"+r.data("id"),method:"post",data:{note:n},success:location.reload.bind(location)})})}}]),e}())},{}],4:[function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();n["default"]=new(function(){function e(){t(this,e)}return i(e,[{key:"index",value:function(){var e=function(e,r){var n=$("input[name="+e+"]").typeahead({highlight:!0,classNames:{dataset:"dropdown-menu tt-dataset"}},{async:!0,limit:7,display:r,templates:{notFound:function(){return"Ничего не найдено"},pending:function(){return"Загружаем..."}},source:_.debounce(function(r,n,t){var i={};i[e]=r,$.ajax({url:"/admin/api/organization/search",data:i}).then(t)},500)});n.bind("typeahead:select",function(e,r){window.open("/admin/organization/"+r.id+"/edit")})};e("name","fullName"),e("edrpou","edrpou"),e("chief","fullName"),$(".show-department-btn").click(this._showDepartments.bind(this)),$(".show-all-departments").click(this._showAllDepartments.bind(this))}},{key:"_showDepartments",value:function(e){var r=$(e.currentTarget).data("organization");$(".department"+r).fadeToggle("fast")}},{key:"_showAllDepartments",value:function(){var e=$("tr.department");$(e[0]).is(":visible")?$("tr.department").fadeOut("fast"):$("tr.department").fadeIn("fast")}}]),e}())},{}],5:[function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),a=e("../helpers"),o=function(){function e(){t(this,e),this.clear(),this.CHECK_SYMBOLS=/[^АБВГҐДЕЄЖЗИІЇЙКЛМНОПРСТУФХЦЧШЩЬЮЯабвгґдеєжзиіїйклмнопрстуфхцчшщьюя№ "'(),\-=.\/0123456789;:I]/,this.CHECK_LETTERS=/[АБВГҐДЕЄЖЗИІЇЙКЛМНОПРСТУФХЦЧШЩЬЮЯабвгґдеєжзиіїйклмнопрстуфхцчшщьюя]{2,}/,this.CHECK_FIO=/[^\-.АБВГҐДЕЄЖЗИІЇЙКЛМНОПРСТУФХЦЧШЩЬЮЯабвгґдеєжзиіїйклмнопрстуфхцчшщьюя' ]/}return i(e,[{key:"clear",value:function(){this.errors={},this.warnings={},this.fioDuplicates=[]}},{key:"index",value:function(e){$("input[name=file]").on("change",this._onSelectFile.bind(this)),$(".done").click(this._saveWorkers.bind(this,e))}},{key:"addError",value:function(e,r){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.errors[r]||(this.errors[r]=[]),this.errors[r].push([e,n])}},{key:"addWarning",value:function(e,r){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.warnings[r]||(this.warnings[r]=[]),this.warnings[r].push([e,n])}},{key:"_saveWorkers",value:function(e){return $.ajax({url:"/admin/api/organization/"+e+"/push_workers",method:"post",data:{workers:this.workers,date:this.organization.date},success:function(){window.location.href="/admin/organization/"+e+"/workers"}})}},{key:"_onSelectFile",value:function(e){var r=this;this.clear();var n=e.target.files[0];if(n){var t=/^(\d+)\D/.exec(n.name);if(!t)return alert("Название файла должно содержать ЕДРПОУ номер организации");var i=t[1];a.helpers.showPreloader();var o=new FileReader;o.onload=function(e){r.lines=e.target.result.replace(/[\t ]+/g," ").split("\n"),r._checkFile(i).then(function(e){return r.organization=e.organization,r.workers=e.workers,r.fioErrors=e.fioErrors,Promise.resolve()}).then(r._showFile.bind(r)).then(r._showOrganization.bind(r)).then(r._checkErrors.bind(r)).then(a.helpers.hidePreloader)["catch"](a.helpers.hidePreloader)},o.readAsText(n,"cp1251")}}},{key:"_showOrganization",value:function(){var e=this;return new Promise(function(r,n){$.ajax({url:"/admin/api/organization/search",method:"get",data:{edrpou:e.organization.edrpou},success:function(t){var i=$(".organization");i.html(""),t&&0!=t.length?(e.originOrganization=t[0],i.html("["+e.organization.edrpou+"] "+e.organization.text+" = ["+e.originOrganization.edrpou+"] "+e.originOrganization.fullName),r()):(alert('<p class="alert alert-danger">Организация с ЕДРПОУ '+e.organization.edrpou+" не найдена</p>"),n())}})})}},{key:"_checkErrors",value:function(){return _.isEmpty(this.errors)?($(".done").show(),Promise.resolve()):($(".done").hide(),alert("В файле есть ошибки"),Promise.reject())}},{key:"_addWorkers",value:function(e){return new Promise(function(r,n){return e.errors&&e.errors.length>0?n("file has errors"):void console.log(e.edrpou)})}},{key:"_checkFile",value:function(e){var r=this;return new Promise(function(n,t){var i=r._parseFirstLine(r.lines[0]);i.edrpou=e;for(var a={main:{workers:[],sub:{}}},o=null,s=null,l=void 0,u=1;u<r.lines.length;u++){var c=r.lines[u].trim();if(0!=c.length)if(l=r.CHECK_SYMBOLS.exec(c),l&&r.addError("Неразрещенный символ "+l[0],u,l.index),l=/^=([^=]+)$/.exec(c))(o||s)&&r.addError("Открытие категории, но предыдущая еще не закрылась",u),o=l[1];else if(/^\s*==/.test(c))s&&r.addError("Закрытие категории, но подкатегория не была закрыта",u),o||r.addError("Закрытие категории, но открытия не было",u),o=null;else if(l=/^-([^-].*)$/.exec(c))s&&r.addError("Открытие подкатегории, но предыдущая еще не закрылась",u),o||r.addError("Открытие подкатегории, но родительская категория не была найдена",u),s=l[1];else if(/^\s*--\s*$/.test(c))s||r.addError("Закрытие подкатегории, но открытия не было",u),s=null;else{var d=o?o:"main";a[d]||(a[d]={workers:[],sub:{}});var f=void 0;s?(a[d].sub[s]||(a[d].sub[s]=[]),f=a[d].sub[s]):f=a[d].workers,r._parseWorker(c,{workers:f,line:u})}}o&&r.addError("Неверно открыты/закрыты категории.",r.lines.length-1),r._checkWorkers(a).then(function(e){n({fioErrors:e,workers:a,organization:i})}.bind(r))})}},{key:"_parseFirstLine",value:function(e){var r=e.split(","),n=r[0].trim(),t=r[1].trim();return/^\d{2}\.\d{2}\.\d{4}$/.test(n)||this.addError('Неверный формат даты "'+n+'" (должен быть <11.11.2222>)',0),/^(\d+|-)$/.test(t)||this.addError('Кол-во сотрудников указано неверно "'+t+'" (должно быть число либо <->)',0),{workersCount:parseInt(r[1].trim()),text:r.slice(2).join(",").trim(),date:n}}},{key:"_parseWorker",value:function(e,r){var n=/([^,]+),(.*)$/.exec(e);if(!n)return void this.addError("Невозможно распознать ФИО и должность",r.line);var t=n[1].trim(),i=n[2].trim();if(!this.CHECK_LETTERS.test(i))return void this.addError("Невозможно распознать ФИО и должность",r.line);var a=/^[^абвгґдеєжзиіїйклмнопрстуфхцчшщьюя]/.exec(i);return a&&this.addWarning("Проверте должность",r.line,a.index+n[1].length+(n[2].length-i.length)+1),(a=this.CHECK_FIO.exec(t))?void this.addError("Неразрещенный символ "+a[0],r.line,a.index):void r.workers.push({fio:t,position:i})}},{key:"_checkWorkers",value:function(e){var r=[];for(var n in e){var t=!0,i=!1,a=void 0;try{for(var o,s=e[n].workers[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var l=o.value;r.push(l.fio)}}catch(u){i=!0,a=u}finally{try{!t&&s["return"]&&s["return"]()}finally{if(i)throw a}}for(var c in e[n].sub){var d=!0,f=!1,h=void 0;try{for(var p,v=e[n].sub[c][Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var m=p.value;r.push(m.fio)}}catch(u){f=!0,h=u}finally{try{!d&&v["return"]&&v["return"]()}finally{if(f)throw h}}}}for(var g=0;g<r.length;g++)r.indexOf(r[g],g+1)>=0&&this.fioDuplicates.push(r[g]);return $.ajax({url:"/admin/api/worker/check_new_workers",method:"post",data:{workers:JSON.stringify(r)}})}},{key:"_showFile",value:function(){var e=this,r=$(".file");r.html("");for(var n=function(n){var t=e.lines[n],i=function(e){var r=arguments.length<=1||void 0===arguments[1]?"error-sym":arguments[1];if(!e)return null;var n=t.split("");return e.map(function(e){return e[1]>=0&&(n[e[1]]='<span class="'+r+'">'+n[e[1]]+"</span>",t=n.join("")),e[0]+"<br>"})};if(0!=n&&!/^(-|=)/.test(t)&&0!=t.length){var a=/([^,]+),/.exec(t);if(!a)return"continue";e.fioErrors.indexOf(a[1])>=0&&(t='<span class="warning-sym">'+a[1]+"</span>"+t.substr(a[1].length)),e.fioDuplicates.indexOf(a[1])>=0&&(t='<span class="duplicate-sym">'+t+"</span>")}var o=i(e.errors[n]),s=i(e.warnings[n],"warning-sym");r.append(t+"<br>"),o&&r.append('<p class="alert alert-danger">'+o+"</p>"),!o&&s&&r.append('<p class="alert alert-warning">'+s+"</p>")},t=0;t<this.lines.length;t++){n(t)}return Promise.resolve()}}]),e}();n["default"]=new o},{"../helpers":8}],6:[function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();n["default"]=new(function(){function e(){t(this,e)}return i(e,[{key:"fio",value:function(){$(".page-fio-translate button").click(this._translate.bind(this))}},{key:"_translate",value:function(){return $.ajax({url:"/admin/api/translate/fio",method:"post",data:{firstName:$("#i").val(),lastName:$("#f").val(),middleName:$("#o").val()},success:function(e){$("#i2").val(e.firstName),$("#f2").val(e.lastName),$("#o2").val(e.middleName)}})}}]),e}())},{}],7:[function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();n["default"]=new(function(){function e(){t(this,e)}return i(e,[{key:"index",value:function(e,r){$(".worker .name").click(this.editWorker.bind(this)),$(".department-name").click(this.editDepartment.bind(this,r))}},{key:"editWorker",value:function(e){var r=$(e.currentTarget),n=r.text().split(","),t={},i=void 0;return _.isEmpty(i=prompt("ФИО",n[0]))||(t.fio=i.trim(),_.isEmpty(i=prompt("должность",n.slice(1).join(",").trim())))?void 0:(t.position=i.trim(),$.ajax({method:"post",url:"/admin/api/worker/"+r.data("id"),data:t,success:function(e){return r.html(e.fio+", "+e.position)}}))}},{key:"editDepartment",value:function(e,r){var n=$(r.currentTarget),t=n.text(),i=prompt("Отдел",t);_.isEmpty(i)||$.ajax({method:"post",url:"/admin/api/worker/change_department",data:{snapshot:e,name:t,newName:i.trim(),field:n.data("sub")?"subDepartment":"department"},success:function(e){return n.html(i)}})}}]),e}())},{}],8:[function(e,r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.helpers={showPreloader:function(){$("body").addClass("preloader")},hidePreloader:function(){return $("body").removeClass("preloader"),Promise.resolve()}}},{}],9:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(Array.isArray(e)){for(var r=0,n=Array(e.length);r<e.length;r++)n[r]=e[r];return n}return Array.from(e)}function a(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./controllers/organization_create"),s=t(o),l=e("./controllers/organization_workers"),u=t(l),c=e("./controllers/workers"),d=t(c),f=e("./controllers/organization_list"),h=t(f),p=e("./controllers/organization_inquiry"),v=t(p),m=e("./controllers/translate"),g=t(m),y=function w(){var e=arguments.length<=0||void 0===arguments[0]?window.location.pathname:arguments[0];a(this,w),e=e.replace(/\/$/,"");var r=[[h["default"].index.bind(h["default"]),/admin\/organization$/],[s["default"].index.bind(s["default"]),/admin\/organization\/(create|\d+\/edit)$/],[s["default"].index.bind(s["default"]),/admin\/organization\/\d+\/addDepartment$/],[v["default"].index.bind(v["default"]),/admin\/organization\/\d+\/inquiry$/],[u["default"].index.bind(u["default"]),/admin\/organization\/(\d+)\/addWorkers$/],[d["default"].index.bind(d["default"]),/admin\/organization\/(\d+)\/snapshot\/(\d+)$/],[g["default"].fio.bind(g["default"]),/translate$/]],n=void 0,t=!0,o=!1,l=void 0;try{for(var c,f=r[Symbol.iterator]();!(t=(c=f.next()).done);t=!0){var p=c.value;if(n=p[1].exec(e)){if("function"!=typeof p[0])throw new Error("invalid route method '"+p[1]+"'");p[0].apply(p,i(n.slice(1)));break}}}catch(m){o=!0,l=m}finally{try{!t&&f["return"]&&f["return"]()}finally{if(o)throw l}}};n["default"]=y},{"./controllers/organization_create":2,"./controllers/organization_inquiry":3,"./controllers/organization_list":4,"./controllers/organization_workers":5,"./controllers/translate":6,"./controllers/workers":7}]},{},[1]);