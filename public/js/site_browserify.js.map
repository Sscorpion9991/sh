{"version":3,"names":[],"mappings":"","sources":["site_browserify.js"],"sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * Базовый контроллер\n */\n\nvar Controller = exports.Controller = function () {\n  function Controller() {\n    _classCallCheck(this, Controller);\n\n    this.widgets = [];\n  }\n\n  /**\n   * Запускаем виджет\n   * @param WidgetClass\n   * @param options\n   */\n\n\n  _createClass(Controller, [{\n    key: \"widget\",\n    value: function widget(WidgetClass) {\n      var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n      // сохраняем все объекты виджетов, чтобы потом можно было вызвать у всех destroy\n      this.widgets.push(new WidgetClass(options));\n    }\n\n    /**\n     * Вызывается роутером при смене роута,\n     * удаляем все виджеты\n     */\n\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.widgets[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var widget = _step.value;\n\n          widget.destroy();\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    }\n  }]);\n\n  return Controller;\n}();\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n * Базовый роутер\n */\n\nvar Router = exports.Router = function (_EventEmitter) {\n  _inherits(Router, _EventEmitter);\n\n  /**\n   * @param rules\n   */\n\n  function Router() {\n    var rules = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\n    _classCallCheck(this, Router);\n\n    var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Router).call(this));\n\n    _this.rules = rules;\n    return _this;\n  }\n\n  /**\n   * Запускаем роутер (вызывать один раз)\n   */\n\n\n  _createClass(Router, [{\n    key: 'start',\n    value: function start() {\n      this._findRoute();\n    }\n\n    /**\n     * Меняем адрес и переходим\n     * @param url\n     * @param opt\n     */\n\n  }, {\n    key: 'navigate',\n    value: function navigate(url, opt) {\n      if (!/^\\/[a-z]{2}\\//.test(url) && !/^\\/[a-z]{2}$/.test(url)) url = '/' + window.locale + url;\n      history.pushState(null, '', url);\n      this.changeUrl(opt);\n    }\n\n    /**\n     * Вызывается когда поменялся URL\n     */\n\n  }, {\n    key: 'changeUrl',\n    value: function changeUrl(opt) {\n      var _this2 = this;\n\n      return $.ajax(_.extend(opt, {\n        url: location.pathname + location.search,\n        success: function success(data) {\n          $('#content').html(data);\n          _this2._findRoute();\n          $(window).scrollTop(0);\n          $('.button-collapse').sideNav('hide');\n          $('#content .dropdown-button').dropdown();\n        },\n\n        error: function error(xhr) {\n          $('#content').html(xhr.responseText);\n          _this2._findRoute();\n          $(window).scrollTop(0);\n          $('.button-collapse').sideNav('hide');\n        }\n      }));\n    }\n\n    /**\n     * Запускаем роут который соответствует текущего адресу\n     * @private\n     */\n\n  }, {\n    key: '_findRoute',\n    value: function _findRoute() {\n      var url = location.pathname;\n      if (/^\\/[a-z]{2}(\\/.*|)$/.test(url)) url = url.replace(/^\\/[a-z]{2}/, '');\n      url = url.replace(/\\/$/, '');\n\n      var matches = void 0;\n      // запускаем медом clear у контроллера который сейчас работает\n      // перед тем как запустить новый метод контроллера\n      if (this.lastController) this.lastController.clear();\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.rules[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var rule = _step.value;\n\n          if (matches = rule[2].exec(url)) {\n            if (typeof rule[0][rule[1]] != 'function') throw new Error('invalid controller method \\'' + rule[1] + '\\'');\n\n            // запуска метод контроллера\n            rule[0][rule[1]].apply(rule[0], matches.slice(1));\n            // запоминаем какой контроллер запущен\n            this.lastController = rule[0];\n\n            break;\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.emit('change', url);\n    }\n  }]);\n\n  return Router;\n}(EventEmitter);\n\n},{}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Widget = exports.Widget = function () {\n  /**\n   * Вешаем события из _events() и достаем элементы из _ui()\n   * @param options\n   */\n\n  function Widget(options) {\n    var _this = this;\n\n    _classCallCheck(this, Widget);\n\n    this.namespace = this.namespace || this.constructor.name + Math.random().toString().substr(2);\n    this.options = options;\n\n    // находим все элементы для виджета\n    this.ui = {};\n    if (this._ui) {\n      _.forEach(this._ui(), function (val, key) {\n        _this.ui[key] = $(val);\n      });\n    }\n\n    // подключаем все события\n    this.events = [];\n    if (this._events) {\n      _.forEach(this._events(), function (callback, event) {\n        var matches = /^([-_a-z]+) (.*)$/i.exec(event);\n        if (!matches) throw 'event not match \"<event> <selector|ui.element>\"';\n\n        var eventName = matches[1] + '.' + _this.namespace;\n        var selector = matches[2];\n\n        // смотрим если передали вместо селектора элемент из this.ui\n        var ui = /^ui\\.(.*)$/.exec(matches[2]);\n        if (ui) selector = _this.ui[ui[1]];\n        callback = typeof callback == 'function' ? callback : _this[callback];\n        $(selector).on(eventName, callback.bind(_this));\n        _this.events.push(selector);\n      });\n    }\n\n    // live события\n    if (this._live) {\n      _.forEach(this._live(), function (callback, event) {\n        var matches = /^([-_a-z]+) (.*)$/i.exec(event);\n        if (!matches) throw 'event not match \"<event> <selector|ui.element>\"';\n\n        var eventName = matches[1] + '.' + _this.namespace;\n        var selector = matches[2];\n\n        callback = typeof callback == 'function' ? callback : _this[callback];\n        $(document).on(eventName, selector, callback.bind(_this));\n      });\n    }\n  }\n\n  /**\n   * Отключаем события\n   */\n\n\n  _createClass(Widget, [{\n    key: 'destroy',\n    value: function destroy() {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.events[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var e = _step.value;\n\n          $(e).off('.' + this.namespace);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      $(document).off('.' + this.namespace);\n    }\n  }]);\n\n  return Widget;\n}();\n\n},{}],4:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.app = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _router = require('./router');\n\nvar _search = require('./widgets/search');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar app = exports.app = new (function () {\n  function _class() {\n    _classCallCheck(this, _class);\n  }\n\n  _createClass(_class, [{\n    key: 'init',\n    value: function init() {\n      _router.router.start();\n      this._initToken();\n      new _search.SearchWidget();\n    }\n  }, {\n    key: '_initToken',\n    value: function _initToken() {\n      $.ajaxSetup({\n        headers: {\n          'X-CSRF-TOKEN': $('meta[name=\"_token\"]').attr('content')\n        }\n      });\n    }\n  }]);\n\n  return _class;\n}())();\n\n$(function () {\n  // run app\n  app.init();\n});\n\n},{\"./router\":6,\"./widgets/search\":7}],5:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.miscController = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _controller = require('../../base/controller');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar MiscController = function (_Controller) {\n  _inherits(MiscController, _Controller);\n\n  function MiscController() {\n    _classCallCheck(this, MiscController);\n\n    return _possibleConstructorReturn(this, Object.getPrototypeOf(MiscController).apply(this, arguments));\n  }\n\n  _createClass(MiscController, [{\n    key: 'home',\n\n    /**\n     * Главная страница\n     */\n    value: function home() {}\n  }]);\n\n  return MiscController;\n}(_controller.Controller);\n\nvar miscController = exports.miscController = new MiscController();\n\n},{\"../../base/controller\":1}],6:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.router = undefined;\n\nvar _router = require('../base/router');\n\nvar _misc = require('./controllers/misc');\n\nvar router = exports.router = new _router.Router([[_misc.miscController, 'home', /^$/]]);\n\n},{\"../base/router\":2,\"./controllers/misc\":5}],7:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SearchWidget = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _widget = require('../../base/widget');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n * Виджет поиска на главной странице\n */\n\nvar SearchWidget = exports.SearchWidget = function (_Widget) {\n  _inherits(SearchWidget, _Widget);\n\n  function SearchWidget() {\n    _classCallCheck(this, SearchWidget);\n\n    var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(SearchWidget).apply(this, arguments));\n\n    $(document).on('click', function () {\n      _this.ui.results.hide();\n    });\n    return _this;\n  }\n\n  /**\n   * ui\n   * @return {Object}\n   */\n\n\n  _createClass(SearchWidget, [{\n    key: '_ui',\n    value: function _ui() {\n      return {\n        form: '#search-form',\n        input: '#search-form input[name=q]',\n        results: '#search-form .results'\n      };\n    }\n\n    /**\n     * events\n     * @return {Object}\n     */\n\n  }, {\n    key: '_events',\n    value: function _events() {\n      return {\n        'keyup ui.input': _.debounce(this.search.bind(this), 500),\n        'submit ui.form': 'search',\n        'click ui.results': function clickUiResults(e) {\n          return e.stopPropagation();\n        },\n        'click ui.form': function clickUiForm(e) {\n          return e.stopPropagation();\n        }\n      };\n    }\n  }, {\n    key: 'search',\n    value: function search(e) {\n\n      e.preventDefault();\n      $.ajax({\n        url: '/api/search',\n        method: 'post',\n        data: { q: this.ui.input.val() },\n        success: this.renderResults.bind(this)\n      });\n    }\n  }, {\n    key: 'renderResults',\n    value: function renderResults(data) {\n      var html = '';\n\n      // предприятия\n      if (data.organizations.length > 0) {\n        html += '<div class=\"category text-muted\"><div class=\"head\">Предприятия:</div>';\n        html += _.map(data.organizations, function (organization) {\n          return '<a href=\"/organization/' + organization.id + '\">\\n        <span class=\"title\">' + organization.fullName + '</span>\\n        <span class=\"sub-title\">' + (organization.address || '') + '</span>\\n      </a>';\n        }).join('');\n        html += '</div>';\n      }\n\n      if (data.workers.length > 0) {\n        html += '<div class=\"category text-muted\"><div class=\"head\">Работники:</div>';\n        html += _.map(data.workers, function (worker) {\n          return '<a href=\"/worker/' + worker.id + '\">\\n        <span class=\"title\">' + worker.fio + '</span>\\n        <span class=\"sub-title\">' + worker.organization.fullName + '</span>\\n      </a>';\n        }).join('');\n        html += '</div>';\n      }\n\n      if (html.length == 0) {\n        html = '\\n        <h5>Не знайдено жодного працивника або организации</h5>\\n        Ви можете <a href=\"/add\">додати организацию</a> та найближчим часом ми опубликуемо перелик ии працивникив\\n      ';\n      }\n\n      this.ui.results.html(html).show();\n    }\n  }]);\n\n  return SearchWidget;\n}(_widget.Widget);\n\n},{\"../../base/widget\":3}]},{},[4]);\n"],"file":"site_browserify.js","sourceRoot":"/source/"}